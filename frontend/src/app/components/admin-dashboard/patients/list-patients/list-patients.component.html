<div class="card">
  <!-- Barra de Pesquisa -->
  <p-dataView #dv [value]="patients">
    <ng-template pTemplate="header">
      <div class="flex flex-column gap-4">
        <div class="search-bar">
          <!-- Filtro por Nome Completo -->
          <p-inputGroup>
            <p-inputGroupAddon>
              <i class="pi pi-user"></i>
            </p-inputGroupAddon>
            <input
              pInputText
              id="nameFilter"
              [(ngModel)]="nameFilter"
              placeholder="Search by Full Name"
              class="p-inputtext-sm"
            />
          </p-inputGroup>

          <!-- Filtro por Data de Nascimento -->
          <p-inputGroup>
            <p-inputGroupAddon>
              <i class="pi pi-calendar"></i>
            </p-inputGroupAddon>
            <input
              type="text"
              pInputText
              id="birthDateFilter"
              [(ngModel)]="birthDateFilter"
              placeholder="Search by Birth Date"
              class="p-inputtext-sm"
            />
          </p-inputGroup>

          <!-- Filtro por Status -->
          <p-inputGroup class="flex-1">
            <p-inputGroupAddon>
              <i class="pi pi-info-circle"></i>
            </p-inputGroupAddon>
            <p-dropdown
              [(ngModel)]="statusFilter"
              [options]="statusOptions"
              optionLabel="label"
              optionValue="value"
              placeholder="Filter by Status"
              class="p-dropdown-sm"
            ></p-dropdown>
          </p-inputGroup>

          <!-- Botão de Pesquisa -->
          <div class="flex justify-content-start mt-2">
            <button (click)="onSearch()" class="p-button p-button-primary p-button-sm">
              <i class="pi pi-search"></i>
              <span class="ml-2">Search</span>
            </button>
          </div>
        </div>
      </div>
    </ng-template>
  </p-dataView>

  <!-- Tabela de Pacientes -->
  <p-table [value]="patients" [tableStyle]="{ 'min-width': '60rem' }" [rows]="5" [paginator]="true" [rowsPerPageOptions]="[10, 20, 30]">

    <ng-template pTemplate="header">
      <tr class="text-center bg-primary text-white font-bold">
        <th>First Name</th>
        <th>Last Name</th>
        <th>Full Name</th>
        <th>Birth Date</th>
        <th>Gender</th>
        <th>Email</th>
        <th>Phone Number</th>
        <th>Address</th>
        <th>Medical History</th>
        <th>Status</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-patient>
      <tr class="text-center border-top-1 surface-border">
        <td class="p-2">{{ patient.FirstName || 'Not specified' }}</td>
        <td class="p-2">{{ patient.LastName || 'Not specified' }}</td>
        <td class="p-2">{{ patient.FullName || 'Not specified' }}</td>
        <td class="p-2">{{ patient.BirthDate || 'Not specified' }}</td>
        <td class="p-2">{{ patient.Gender || 'Not specified' }}</td>
        <td class="p-2">{{ patient.Email || 'Not specified' }}</td>
        <td class="p-2">{{ patient.PhoneNumber || 'Not specified' }}</td>
        <td class="p-2">{{ patient.Address || 'Not specified' }}</td>
        <td class="p-2">
          <p-button
            icon="pi pi-eye"
            label="View"
            (click)="showMedicalHistory(patient.MedicalRecord)"
            class="p-button-sm"
          ></p-button>
        </td>
        <td class="p-2">
          <p-badge
            [value]="patient.Active ? 'Active' : 'Deactivated'"
            [severity]="patient.Active ? 'success' : 'danger'"
            class="text-sm"
          ></p-badge>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Diálogo de Histórico Médico -->
  <p-dialog header="Medical History" [(visible)]="medicalHistoryDialogVisible" modal="true" [style]="{ width: '40vw' }">
    <p>{{ selectedMedicalHistory }}</p>
  </p-dialog>
</div>
