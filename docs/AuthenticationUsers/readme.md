# US - Authentication Users


## 1. Context

- As a Project Manager, I want the system to support and apply authentication and authorization for all its users and functionalities

## 2. Requirements

*Example*

**US G007** As  a Project Manager, I want the system to support and apply authentication and authorization for all its users and functionalities

**Acceptance Criteria**

**G007.1 :** The password must be generated by the system.
**G007.2 :** The password must have at least 8 characters, including uppercase and lowercase letters, digits and at least one non-alphanumeric character.
**G007.3 :** The system should redirect after the authentication each user to the correct application.

**Dependencies/References:**

>Question : Na criação de um utilizador no sistema o nome é definido pelo utilizador ou é o nome da pessoa (primeiro e último) e se a password é definida pelo utilizador ou gerada pelo sistema?

>Answer : No âmbito da US 2000a o Operator cria utilizadores do sistema para candidatos que ainda não estejam no sistema. Tem de fazer isso com base nos dados recebidos na candidatura (que incluem email e nome). O email servirá para identificar a pessoa. Neste contexto é necessário ter uma password para esse novo utilizador. Uma vez que essa informação não é transmitida pelo candidato, suponho que a solução mais “aconselhada” será o sistema gerar uma password para esse utilizador. Como o utilizador/candidato irá receber essa informação (a forma de autenticação na app) está out of scope, no sentido em que não existe nenhuma US que remete para isso. As US 1000 e 1001 também remetem para criação de utilizadores. Aqui, eventualmente poderia-se pensar em introduzir manualmente as passwords, mas pode ser pelo mesmo mecanismo de definição automática de password, descrito anteriormente.

------------------------------------------------------

>Question : Quais às politicas de negócio para registar um candidato, quais as caracteristicas da password, email, telemóvel?

>Answer : Sobre o telemóvel, seguir o Q56. Sobre email, seria qualquer email válido. Sobre a password, podemos seguir algo como: ter no mínimo 8 caracteres, letras maiúsculas e minúsculas, dígitos e pelo menos, um caracter não alfanumérico.


-------------------------------------------------------

>Question : No número de telémovel e no código postal as verificações são feitas apenas para domínios portugueses, ou temos de programar consuante o país referente?

>Answer : Basta para o caso português.


--------------------------------------------------------

>Question : Pretende-se que todos os utilizadores acedam à mesma aplicação e que consoante as credências tenham acesso a funcionalidades diferentes ou são aplicações diferentes (que acedem à mesma base de dados)?

>Answer : Do ponto de vista do product owner faz sentido ter aplicações distintas. Ou seja, quando, por exemplo, um utilizador “executa” a aplicação “Candidate App” mesmo que se identifique como um user válido do tipo “Customer” a aplicação não deve aceitar esse login.

## 3. Analysis

![User Domain Model](/svg/user-domain-model.svg)


## 4. Design

### 4.1. Realization
*To implement this US i used the EAPLI framework*

*Below is the link with the documentation of this US*

The entity in the framework that will be used is a **SystemUser**.

To improve the quality of the password we decided to use a new Encoder (better than the framework encoder). For that 
we are going to develop the **Jobs4uPasswordPolicy** and **Jobs4uPasswordEncoder**.

To generate the password we are going to develop a **PasswordGenerator** that generates a password following the password policy.

### 4.2. Class Diagram

https://pagsousa.bitbucket.io/13.0/eapli.framework.authz/

### 4.3. Applied Patterns

### 4.4. Tests


**Test 1:** *The password must have at least 8 characters, including uppercase and lowercase letters, digits and at least one non-alphanumeric character.*

**Refers to Acceptance Criteria:** G007.2


```
@Test
    void ensurePasswordHasAtLeastOneDigitOneCapitalOneNonAlphaNumericAnd8CharactersLong() {
        assertTrue(subject.isSatisfiedBy("abCfefgh1!"));
    }

    @Test
    void ensurePasswordsSmallerThan8CharactersAreNotAllowed() {
        assertFalse(subject.isSatisfiedBy("ab1c"));
    }

    @Test
    void ensurePasswordsWithoutDigitsAreNotAllowed() {
        assertFalse(subject.isSatisfiedBy("abcefghi"));
    }

    @Test
    void ensurePasswordsWithoutCapitalLetterAreNotAllowed() {
        assertFalse(subject.isSatisfiedBy("abcefghi1"));
    }

    @Test
    void ensurePasswordsWithoutAlphaNumericAreNotAllowed() {
        assertFalse(subject.isSatisfiedBy("dsadsadsadsaA1"));
    }
````


**Test 3:** *The password must be generated by the system.*

**Refers to the Acceptance Criteria :** G007.1

````
 @Test
    public void testGeneratedPasswordLength() {
        String password = passwordGenerator.generatePassword();
        assertTrue(password.length() >= 8, "A senha deve ter pelo menos 8 caracteres");
    }

    @Test
    public void testGeneratedPasswordContainsDigit() {
        String password = passwordGenerator.generatePassword();
        assertTrue(password.matches(".*\\d.*"), "A senha deve conter pelo menos um dígito");
    }

    @Test
    public void testGeneratedPasswordContainsUpperCase() {
        String password = passwordGenerator.generatePassword();
        assertTrue(password.matches(".*[A-Z].*"), "A senha deve conter pelo menos uma letra maiúscula");
    }

    @Test
    public void testGeneratedPasswordContainsSpecialCharacter() {
        String password = passwordGenerator.generatePassword();
        assertTrue(password.matches(".*[!@#$%^&*()-_=+].*"), "A senha deve conter pelo menos um caractere especial");
    }
````
## 5. Implementation

*In this section the team should present, if necessary, some evidencies that the implementation is according to the design. It should also describe and explain other important artifacts necessary to fully understand the implementation like, for instance, configuration files.*

*It is also a best practice to include a listing (with a brief summary) of the major commits regarding this requirement.*

